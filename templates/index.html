{% extends "base.html" %}

{% block title %}Trang ch·ªß - Tr·∫°m S√°ch{% endblock %}

{% block content %}
<!-- Hero Banner -->
<section class="hero-banner-modern">
    <div class="container">
        <div class="hero-content-modern">
            <div class="hero-text-modern">
                <div class="hero-badge-modern">Xu h∆∞·ªõng 2024</div>
                <h1 class="hero-title-modern text-gradient">Kh√°m ph√°<br>Th·∫ø gi·ªõi tri th·ª©c</h1>
                <p class="hero-subtitle-modern">H∆°n 10,000 ƒë·∫ßu s√°ch tuy·ªÉn ch·ªçn v·ªõi ∆∞u ƒë√£i ƒë·∫∑c quy·ªÅn. Giao h√†ng si√™u t·ªëc
                    trong 2h.</p>
                <div class="hero-actions-modern">
                    <a href="/category/all" class="btn btn-primary btn-large">Mua s·∫Øm ngay</a>
                    <a href="/category/self-help" class="btn btn-secondary btn-large">T√¨m hi·ªÉu th√™m</a>
                </div>
                <div class="hero-stats" style="margin-top: 40px; display: flex; gap: 32px;">
                    <div>
                        <div style="font-size: 24px; font-weight: 700;">10k+</div>
                        <div style="font-size: 13px; color: var(--text-secondary);">ƒê·∫ßu s√°ch</div>
                    </div>
                    <div>
                        <div style="font-size: 24px; font-weight: 700;">4.9‚òÖ</div>
                        <div style="font-size: 13px; color: var(--text-secondary);">Tin d√πng</div>
                    </div>
                </div>
            </div>
            <div class="hero-image-modern">
                <div class="hero-book-stack" id="hero-book-stack">
                    <!-- Books will be loaded here -->
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Featured Categories -->
<section class="container" style="margin-top: var(--spacing-xxl);">
    <div class="section-header-modern">
        <div>
            <h2 class="section-title-modern">Danh m·ª•c n·ªïi b·∫≠t</h2>
            <p class="section-subtitle-modern">Kh√°m ph√° c√°c th·ªÉ lo·∫°i s√°ch ƒëa d·∫°ng</p>
        </div>
        <a href="/category/all" class="btn btn-secondary">Xem t·∫•t c·∫£</a>
    </div>

    <div id="categories" class="category-grid-modern">
        <!-- Categories will be loaded here -->
    </div>
</section>

<!-- Featured Products -->
<section class="container" style="margin-top: var(--spacing-xxl); padding-bottom: var(--spacing-xl);">
    <div class="section-header-modern">
        <div>
            <h2 class="section-title-modern">S√°ch n·ªïi b·∫≠t</h2>
            <p class="section-subtitle-modern">Nh·ªØng cu·ªën s√°ch ƒë∆∞·ª£c y√™u th√≠ch nh·∫•t tu·∫ßn n√†y</p>
        </div>
        <div style="text-align: right;">
            <span style="font-size: 13px; color: var(--text-secondary);">∆Øu ƒë√£i k·∫øt th√∫c sau:</span>
            <div style="font-size: 17px; font-weight: 600; color: var(--primary-color);">
                <span id="hours">02</span>:<span id="minutes">35</span>:<span id="seconds">40</span>
            </div>
        </div>
    </div>

    <div id="featured-books" class="product-grid-modern">
        <!-- Books will be loaded here -->
    </div>
</section>

<!-- New Arrivals -->
<section class="container" style="margin-top: var(--spacing-xl);">
    <div class="section-header-modern">
        <div>
            <h2 class="section-title-modern">S√°ch m·ªõi</h2>
            <p class="section-subtitle-modern">C·∫≠p nh·∫≠t nh·ªØng cu·ªën s√°ch m·ªõi nh·∫•t</p>
        </div>
        <a href="/category/all?sort_by=newest" class="btn btn-secondary">Xem th√™m</a>
    </div>

    <div id="new-books" class="product-grid-modern">
        <!-- New books will be loaded here -->
    </div>
</section>

<!-- Category: VƒÉn h·ªçc -->
<section class="container" style="margin-top: var(--spacing-xl); margin-bottom: var(--spacing-xxl);">
    <div class="section-header-modern">
        <div>
            <h2 class="section-title-modern">VƒÉn h·ªçc</h2>
            <p class="section-subtitle-modern">Nh·ªØng t√°c ph·∫©m vƒÉn h·ªçc kinh ƒëi·ªÉn v√† hi·ªán ƒë·∫°i</p>
        </div>
        <a href="/category/van-hoc" class="btn btn-secondary">Xem t·∫•t c·∫£</a>
    </div>

    <div id="literature-books" class="product-grid-modern">
        <!-- Books will be loaded here -->
    </div>
</section>

<!-- Newsletter -->
<section class="newsletter-section">
    <div class="container">
        <div class="newsletter-content">
            <h2>Gia nh·∫≠p c·ªông ƒë·ªìng</h2>
            <p>Nh·∫≠n th√¥ng b√°o ƒë·∫∑c quy·ªÅn v·ªÅ c√°c ƒë·∫ßu s√°ch gi·ªõi h·∫°n v√† qu√† t·∫∑ng b√≠ m·∫≠t.</p>
            <form class="newsletter-form" onsubmit="handleNewsletter(event)">
                <div class="input-group">
                    <input type="email" placeholder="Email c·ªßa b·∫°n" required>
                    <button type="submit" class="btn btn-primary">ƒêƒÉng k√Ω ngay</button>
                </div>
            </form>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        // Load hero book stack
        try {
            const booksResponse = await fetch('/api/products/?limit=3');
            const books = await booksResponse.json();
            const bookStackContainer = document.getElementById('hero-book-stack');

            if (books.length > 0) {
                bookStackContainer.innerHTML = '';
                books.forEach((book, index) => {
                    const bookItem = document.createElement('div');
                    bookItem.className = `book-stack-item book-${index + 1}`;
                    bookItem.innerHTML = `<img src="${book.image_url || '/static/images/placeholder.jpg'}" alt="${book.title}" onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iNDAwIiB2aWV3Qm94PSIwIDAgMzAwIDQwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2Y1ZjVmNyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIyNCIgZmlsbD0iIzg2ODY4YiI+Tm8gSW1hZ2U8L3RleHQ+PC9zdmc+'">`;
                    bookStackContainer.appendChild(bookItem);
                });
            }
        } catch (error) {
            console.error('Error loading hero books:', error);
        }

        // Load categories
        try {
            const catResponse = await fetch('/api/products/categories/all');
            const categories = await catResponse.json();
            const catContainer = document.getElementById('categories');
            const icons = ['üìö', 'üí°', 'üìñ', 'üé®', 'üî¨'];

            categories.forEach((cat, index) => {
                const card = document.createElement('a');
                card.href = `/category/${cat.slug}`;
                card.className = 'category-card-modern';
                card.innerHTML = `
                    <span class="category-icon">${icons[index % icons.length]}</span>
                    <h3>${cat.name}</h3>
                `;
                catContainer.appendChild(card);
            });
        } catch (error) {
            console.error('Error loading categories:', error);
        }

        // Load sections helper
        const loadSection = async (url, containerId) => {
            try {
                const response = await fetch(url);
                const books = await response.json();
                const container = document.getElementById(containerId);
                if (container) {
                    books.forEach(book => container.appendChild(createProductCard(book)));
                }
            } catch (error) { console.error(`Error loading ${containerId}:`, error); }
        };

        loadSection('/api/products/?limit=8', 'featured-books');
        loadSection('/api/products/?limit=4&sort_by=newest', 'new-books');
        loadSection('/api/products/?limit=4&offset=5', 'literature-books');

        // Timer
        let timeLeft = 2 * 3600 + 35 * 60 + 40;
        setInterval(() => {
            const h = Math.floor(timeLeft / 3600);
            const m = Math.floor((timeLeft % 3600) / 60);
            const s = timeLeft % 60;
            document.getElementById('hours').textContent = String(h).padStart(2, '0');
            document.getElementById('minutes').textContent = String(m).padStart(2, '0');
            document.getElementById('seconds').textContent = String(s).padStart(2, '0');
            timeLeft = timeLeft > 0 ? timeLeft - 1 : 2 * 3600;
        }, 1000);
    });

    function createProductCard(book) {
        const card = document.createElement('a');
        card.href = `/product/${book.id}`;
        card.className = 'product-card-modern';
        card.innerHTML = `
            <div style="position: relative; overflow: hidden; border-radius: 16px;">
                <img src="${book.image_url || '/static/images/placeholder.jpg'}" alt="${book.title}" class="product-image-modern" onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iNDAwIiB2aWV3Qm94PSIwIDAgMzAwIDQwMCI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2Y1ZjVmNyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIyNCIgZmlsbD0iIzg2ODY4YiI+Tm8gSW1hZ2U8L3RleHQ+PC9zdmc+'">
            </div>
            <div class="product-info-modern">
                <p class="product-category-modern">${book.category_name || 'S√°ch'}</p>
                <h3 class="product-title-modern">${book.title}</h3>
                <p class="product-author-modern">${book.authors}</p>
                <div class="product-rating-modern">‚≠ê ${book.rating_avg.toFixed(1)}</div>
                <p class="product-price-modern">${BookStore.formatPrice(book.price_vnd)}</p>
            </div>
        `;
        return card;
    }

    function handleNewsletter(event) {
        event.preventDefault();
        BookStore.showNotification('C·∫£m ∆°n b·∫°n ƒë√£ ƒëƒÉng k√Ω!', 'success');
    }
</script>
{% endblock %}